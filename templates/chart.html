<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TradingView Style</title>
  <style>
    body { margin: 0; background: white; }
    #price { width: 1200px; height: 400px; }
    #macd { width: 1200px; height: 200px; margin-top: 10px; }
    #volume { width: 1200px; height: 150px; margin-top: 10px; }
  </style>
</head>
<body>
  <div id="price"></div>
  <div id="macd"></div>
  <div id="volume"></div>

  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.2/dist/lightweight-charts.standalone.production.js"></script>
  <script>
    window.chartReady = false;

    try {
      // Chart harga
      const priceChart = LightweightCharts.createChart(document.getElementById('price'), {
        width: 1200,
        height: 400,
        layout: { backgroundColor: '#ffffff', textColor: '#000' },
        grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } },
        crosshair: { mode: LightweightCharts.CrosshairMode.Normal }
      });

      window.candleSeries = priceChart.addCandlestickSeries();
      window.ma5Series = priceChart.addLineSeries({ color: 'orange', lineWidth: 2 });
      window.ma20Series = priceChart.addLineSeries({ color: 'green', lineWidth: 2 });
      window.supportSeries = priceChart.addLineSeries({ color: 'blue', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dotted });
      window.resistanceSeries = priceChart.addLineSeries({ color: 'red', lineWidth: 1, lineStyle: LightweightCharts.LineStyle.Dotted });

      // Chart MACD
      const macdChart = LightweightCharts.createChart(document.getElementById('macd'), {
        width: 1200,
        height: 200,
        layout: { backgroundColor: '#ffffff', textColor: '#000' },
        grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } },
        priceScale: { scaleMargins: { top: 0.2, bottom: 0.2 } }
      });

      window.macdSeries = macdChart.addLineSeries({ color: 'blue', lineWidth: 1 });
      window.signalSeries = macdChart.addLineSeries({ color: 'orange', lineWidth: 1 });
      window.histogramSeries = macdChart.addHistogramSeries({ color: '#26a69a', base: 0 });

      // Chart Volume
      const volumeChart = LightweightCharts.createChart(document.getElementById('volume'), {
        width: 1200,
        height: 150,
        layout: { backgroundColor: '#ffffff', textColor: '#000' },
        grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } },
        priceScale: { scaleMargins: { top: 0.2, bottom: 0.2 } }
      });

      window.volumeSeries = volumeChart.addHistogramSeries({
        color: '#26a69a',
        priceFormat: { type: 'volume' },
        base: 0
      });

      // âœ… Sinkronisasi aman: hanya priceChart yang mengontrol
      priceChart.timeScale().subscribeVisibleLogicalRangeChange((range) => {
        if (range !== null) {
          macdChart.timeScale().setVisibleLogicalRange(range);
          volumeChart.timeScale().setVisibleLogicalRange(range);
        }
      });

      window.chartReady = true;
    } catch (e) {
      console.error("Chart error:", e);
      window.chartReady = true;
    }
  </script>
</body>
</html>